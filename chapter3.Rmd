# 3. Logistic regression
```{r echo=FALSE}
library(dplyr)
library(tidyr)
library(ggplot2)
````

### 3.1-3.2 Dataset: alcohol use in secondary school students 
```{r}
alc <- read.csv("http://s3.amazonaws.com/assets.datacamp.com/production/course_2218/datasets/alc.txt",sep=",",header = TRUE)
names(alc)
```  
The data is a combination of questionnaire and school-collected data of 382 students, collected from two secondary schools in Portugal (see [Cortez & Silva, 2008](http://www3.dsi.uminho.pt/pcortez/student.pdf)). Dataset includes some basic background information on students (e.g. gender and age), their family relations, school history, and grades (G1-G3, averages of maths and portugues grades for 1st, 2nd and 3rd period). Students have also been asked about time and motivation they spend on studies, and some questions about their free time use[^1].  
[^1]: For a full list of data attributes and their abbreviations, see <https://archive.ics.uci.edu/ml/datasets/Student+Performance>

Average of alcohol consumption (*alc_use*) has been calculated from average of scores (1=very low, 5=very high) with which student described their alcohol use during week or in the week ends. Students with an average alcohol use score above 2 are considered to have a high alcohol use.

### 3.3 Aim of study and hypotheses
From a dataset described above, several interesting questions related to risk factors or consequences of high alcohol use (such as absences, failing a class, poor grades, parental support or general family situation) could be investigated. However, my interest lies more in risk-reducing aspects related to social support and aspirations of the secondary school students. In other words, I want to identify factors which reduce the chances that a student develops a high alcohol use.  

Specifically, my aim is to study whether family relations (high values in `famrel`), tendency to go out with friends (high values in `goout`), being in a romantic relationship (binary variable `romantic`) or wish to take a higher education (binary variable `higher`) are related to high alcohol use among Portuguese secondary school students.  

The predicted relationships between these variables are:  
*H1. Good family relations reduce the chances of developing a high alcohol use.* In secondary school students, high alcohol use might be related to the rebelling against authorities. On the other hand, in students who will occasionally use alcohol, I would assume that a good relationship with parents enables parental intervention before the alcohol use in their kids increases.  
*H2. Tendency to go out with your friends* will probably increase the occurrences of alcohol use, and thus *increase the probability for high alcohol use.* The underlying assumption is that among secondary school students, it is most common to use alcohol with your friends.  
*H3. Being in a romantic relationship reduces the probability of high alcohol use.* In some students, the reason for going out to party (which would, in most cases, include alcohol) might be a wish to find someone. Being in a relationship might decrease the need to go searching or otherwise alter the way the students use their free time in directions which involve less alcohol.  
*H4. Wish to take higher studies reduces probability for high alcohol use*, since the students with high ambition or career dreams might be more likely to spend more time on their studies, thus decreasing the time spent on parties.   

### 3.4 Exploring the data  

**Distributions of chosen variables**  
For graphical exploration using functions `gather()` and `glimpse()`, let's look at the subset of the original dataset. For data exploration purposes, we will include also the variable `alc_use` which was used for defining the target variables `high_use`.  
```{r warning=FALSE}
variables <- c("famrel","goout","romantic","higher","alc_use","high_use")
alc_subset <- subset(alc,select = variables)

gather(alc_subset) %>% glimpse()#gather() reorders the subsetted dataset (6 x 382 variables) into two columns "key" (variable names) and "value", so that the gathered dataset is a matrix of 2292 (=6x382) rows and 2 columns 
gather(alc_subset) %>% ggplot(aes(value)) + facet_wrap("key", scales = "free") + geom_bar() + ggtitle("Variable distributions") + theme(plot.title = element_text(hjust=0.5))
````   

From the bar plots of numerical variables (on the first row), we can see that `goout` seems normally distributed but distributions of alcohol use (`alc_use`) and family relationships `famrel` are skewed. Most of the secondary school students use very little alcohol and have fairly good relationship with their families.  

From the binary variables (on the second row), we can see that most of the students do not have a high alcohol use and are not in a romantic relationship, but grand majority of them do hope to pursue higher education. This is maybe good news for the students but may indicate poor predictive power for the variable `higher`, unless every student not wishing to aim for higher education uses a lot of alcohol, see *hypothesis 4*.   

**Relationships between the target and predictor variables**  
To start exploring how predictor variables might be related to the alcohol use or high alcohol use, let's tabulate the number of students in each group and mean alcohol use per each group of categorical predictor variables.
```{r}
alc_subset %>% group_by(romantic,higher) %>% summarise(count = n(), mean_famrel=mean(famrel), mean_goout=mean(goout), mean_alcuse = mean(alc_use))
```  
From this table, it looks like an aspiration for higher education decreases alcohol use: mean alcohol use for the 18 students not hoping to continue their studies is nearly 0.5 units higher than in 364 students who said they would like to continue to higher education. Since the alcohol use in these groups fall on opposing sides of the limit for high use (2), *this finding supports hypothesis 4*. It might be noteworthy that the lower alcohol use in students who wish to go for higher education may be related to more intense studying (or less friends eager to go out), since also the mean of `goout` is lower in this group.  

Unlike the aspiration for higher education, being in a romantic relationship does not seem to affect alcohol use, so the means look like *hypothesis 3 is not supported by the data*. People in romantic relationship seem to have slightly lower family relationships (maybe parents have opinions on other things besides alcohol use in Portugal), but the difference in scores is really small.  

Using means to summarize data with skewed distributions can be problematic, so let's check the variability in alcohol use within in each group by looking at the following boxplot. Relationship status (`romantic`) is shown with different colors and the limit between low/high alcohol use is shown by a dashed horisontal line. 
```{r}
g1 <- ggplot(alc_subset,aes(x=higher,y=alc_use,col=romantic)) 
g1 + geom_boxplot() + ylab("alcohol use") + xlab("wishes to continue studying after school") + ggtitle("Mean alcohol use") + theme_classic() + geom_hline(yintercept = 2,linetype="dashed",color="gray")
```   

It looks like *we can continue believing in hypothesis 4*.  

From this boxplot, it looks like it might be possible to find an interactive effect of romantic relationship and aspiration of higher studies on alcohol use - at least, if there is a reason to suspect the high alcohol use of a who is in a relationship but does not want to continue studying after secondary school. If this student can be rejected as an outlier, it seems possible that there could be an effect of relatioship within students without aspirations for higher education. However, if we don't have a good reason to suspect exceptional circumstances or change the hypothesis to exclude this outlier, it *still does not seem that the hypothesis 3 would be supported by data*.   

Exploring the potential effect of numerical variables might be easier if we tabulate the means scores for students with or without high alcohol use.
```{r}
alc_subset %>% group_by(high_use) %>% summarise(count = n(), mean_famrel=mean(famrel), mean_goout=mean(goout))
```  
From this table, it looks like high alcohol use is related to lower score in family relationships and higher going-out rate (supporting *hypotheses 1* and *2*). Let's try checking also this graphically:  
```{r}
g2 <- ggplot(alc_subset,aes(x=high_use,y=famrel))
g2 + geom_boxplot() + ylab("quality of family relations") + xlab("high alcohol use") + ggtitle("Family relations in students with low/high alcohol use") + theme_classic()
g3 <- ggplot(alc_subset,aes(x=high_use,y=goout))
g3 + geom_boxplot() + ylab("going out with friends") + xlab("high alcohol use") + ggtitle("Tendency to go out in students with low/high alcohol use") + theme_classic()
```   

The boxes (depicting the majority of observations) do not overlap in either figure, so the distribution of variables `famrel` and `goout` in students with low/high alcohol use continue to support *hypotheses 1 and 2* as described above.


### 3.5 Make a logistic regression, show and interpret summary, transform coefficients into odd rations and provide confidence intervals  
Interpret results in relation to hypotheses  

### 3.6 Predictive power of the logistic regression model 
Comment on results, compare model performance with simple-guessing performance

### 3.7 10-fold cross validation of own model 
Compare the own model to datacamp model

### 3.8 Compare performance of different models  
How does number of predictors affect training/testing error rate?
